apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- ../../base

# 1. Global Patch: Switch ALL Repo URLs to local filesystem
patches:
- target:
    kind: Application
    group: argoproj.io
  patch: |
    - op: replace
      path: /spec/source/repoURL
      value: file:///repo
    - op: remove
      path: /spec/source/targetRevision

# 2. Specific Patch: Exclude Cilium from Foundation Config
# This prevents ArgoCD from deploying platform/01-foundation/cilium.yaml
- target:
    kind: Application
    name: foundation-config
  patch: |
    - op: add
      path: /spec/source/directory
      value:
        exclude: 'cilium.yaml'